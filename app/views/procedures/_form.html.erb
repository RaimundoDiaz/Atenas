<%= form_with model: @procedure, id: "form_procedure" do |form|%>

  <b>Información general del procedimiento:</b>
  <div id="general" class="greyContainer">
    <div id="datetime" class="mb-3 d-flex justify-content-between">
      <div class="form-inline">
        <%= form.label :date, 'Fecha: ', class: "mr-2 form-label"%>
        <%= form.date_field :date , class: "form-control"%>
      </div>

      <div class="form-inline">
        <%= form.label :time, 'Hora: ', class: "mr-2 form-label"%>
        <%= form.time_field :time, class: "form-control" %>
      </div>
    </div>

    <div id="classification" class="mb-3 d-flex justify-content-between">
      <% classifications = ["Flagrancia", "ODP", "Ambas"].map { |classification| [classification] } %>
      <div class="form-inline">
        <%= form.label :classification, 'Clasificación:' , class: "mr-2 form-label"%>
        <%= form.select :classification, options_for_select(classifications),{},{class: "form-control flex-grow"} %>
      </div>
    </div>

    <div id="deceased">
      <div class="custom-control custom-switch">
        <%= form.check_box :involves_deceased, class: "custom-control-input", id: "procedure_involves_deceased"  %>
        <%= form.label :involves_deceased, 'Involucra fallecidos', class: "custom-control-label", for:"procedure_involves_deceased" %>
      </div>
    </div>
  </div>

  <div id="involved" class="greyContainer">
    <div class="form-inline">
      <% if !current_user.local_prosecution %>
        <%= form.label :prosecution_in_charge, 'Fiscalia a cargo:', class: "mr-2 form-label" %>
        <%= form.select :prosecution_in_charge, options_for_select(LocalProsecution.order(:name).map { |prosecution| [prosecution[:name], prosecution[:id]] }),{},{class: "form-control flex-grow-1"} %>
      <% else %>
        <%= form.hidden_field :prosecution_in_charge, :value => current_user.local_prosecution.id %>
      <% end %>

    </div>

    <div class="form-inline">
      <%= form.label :prosecutor_in_charge, 'Fiscal a cargo:', class: "mr-2 form-label" %>
      <%= form.select :prosecutor_in_charge, options_for_select(Prosecutor.order(:name).map { |prosecutor| [prosecutor[:name], prosecutor[:id]] }),{},{class: "form-control flex-grow-1"} %>
    </div>

    <div class="form-inline">
      <%= form.label :police_unit_in_charge, 'unidad policial a cargo:', class: "mr-2 form-label" %>
      <%= form.select :police_unit_in_charge, options_for_select(PoliceUnit.order(:name).map { |policeUnit| [policeUnit[:name],policeUnit[:id]] }),{},{class: "form-control flex-grow-1"} %>
      <%= form.label :police_in_charge, 'policia a cargo:', class: "mr-2 form-label" %>
      <%= form.select :police_in_charge, options_for_select(PoliceMan.order(:name).map { |police| ["%s - %s"%[police[:name].to_s,police[:badge].to_s],police[:id]] }),{},{class: "form-control flex-grow-1"} %>
    </div>

  </div>


  <b>Localización:</b>
  <div id="address" class="greyContainer">
    <div class="form-inline mb-3">
      <%= form.label :address, 'Dirección:' , class: "mr-2 form-label"%>
      <%= form.text_field :address,  class: "form-control flex-grow-1"  %>
    </div>

    <div class="d-flex justify-content-between">
      <% cities_array = @regiones.map { |city| [city[:nombre], city[:codigo]] } %>
      <div class="form-inline">
        <%= form.label :region, 'Región:', class: "mr-2 form-label" %>
        <%= form.select :region, options_for_select(cities_array),{},{class: "form-control"} %>
      </div>

      <div class="form-inline">
        <%= form.label :sector, 'Comuna:', class: "mr-2 form-label" %>
        <%= form.select :sector, [],{},{class: "form-control"} %>
      </div>
    </div>
  </div>

  <b>Delitos:</b>
  <div id="crimes" class="greyContainer">
    <% crimes = Crime.order(:name).map{|crime| [crime[:name]]} %>
    <div class="form-inline d-flex justify-content-between">
      <%= form.label :preponderant_crime, 'Delito preponderante:', class: "form-label mr-2" %>
      <%= form.select :preponderant_crime, options_for_select(crimes),{},{class: "form-control flex-grow-1"} %>
    </div>
    <div id = "new_crime" class="mt-3 form-inline d-flex justify-content-between">
      <%= fields_for "procedure[crimes]" do |crimes_fields| %>
        <%= crimes_fields.label "", 'Delito:', class: "form-label mr-2"%>
        <%= crimes_fields.select "" , options_for_select(crimes), {name: "procedure[crimes][]"},{class: "form-control flex-grow-1"}  %>
      <% end %>
      <button type="button" class="ml-2 btn btn-danger delete_crime"> Eliminar delito </button>
    </div>
  </div>

  <div id="crime_btn_div" class="mb-3"><button type="button" id="add_crime_btn" class="btn btn-primary"> Agregar delito </button></div>

  <b>Marcas:</b>
  <div id="marks" class="form-group greyContainer">
    <%= form.select :tag_ids, options_for_select(Tag.order(:name).map { |tag| [tag[:name]] }, params[:tag_ids]),{},{class: "form-control",multiple: true} %>
  </div>

  <b>Imputados:</b>
  <div id="accuseds" class="greyContainer">
    <button type="button" id="add_accused_btn" class="mb-3 btn btn-warning text-light" data-toggle="modal" data-target="#accusedModal"> + Agregar Imputado </button>
  </div>

  <b>Víctimas:</b>
  <div id="victims" class="greyContainer">
    <button type="button" id="add_victim_btn" class="mb-3 btn btn-warning text-light" data-toggle="modal" data-target="#victimModal"> + Agregar Víctima </button>
  </div>

  <b>Testigos:</b>
  <div id="witnesses" class="greyContainer">
    <button type="button" id="add_witness_btn" class="mb-3 btn btn-warning text-light" data-toggle="modal" data-target="#witnessModal"> + Agregar Testigo </button>
  </div>

  <b>Relato:</b>
  <div id="story" class="greyContainer">
    <%= form.text_area :story,  class: "form-control flex-grow-1"  %>
  </div>
  <b>Archivos:</b>
  <div id="address" class="greyContainer">
    <div class="form-group">
      <%= form.label :photos, 'Fotos:' , class: "mr-2 form-label"%>
      <%= form.file_field :photos, class: "form-control-file" %>
    </div>
    <div class="form-group">
      <%= form.label :photos, 'Videos:' , class: "mr-2 form-label"%>
      <%= form.file_field :videos, class: "form-control-file" %>
    </div>
  </div>
  <div>
    <%= form.submit "Enviar", class: "btn btn-primary", id:"btn-send"%>
  </div>
  </div>


<% end %>
